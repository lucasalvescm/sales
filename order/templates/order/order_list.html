{% extends 'core/base.html' %}

{% block content %}

<div class="card mb-3">
    <div class="card-header">
      <i class="fa fa-table"></i> Lista de Vendas</div>
    <div class="card-body">
    <div class="btn-group" role="group" aria-label="Basic example">
        <a class="btn btn-info" role="button" href="{% url 'order:order_new' %}">Nova Venda</a>
    </div>
    <hr size="30"> 
      <div class="table-responsive">
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
            <tr>                   
              <th>Data do Pedido</th>
              <th>Cliente</th>
              <th>Valor da Venda</th>
              <th>Produto</th>
              <th>Quantidade</th>
              <th>Descrição</th>
              <th>Data de Entrega</th>
              <th>Entregue</th>
              <th>Cancelado</th>
            </tr>
          </thead>
        
          <tbody>
            {%for order in object_list%}
            <tr>
                    <td>{{order.order_date}}</td>
                    <td>{{order.client.name}}</td>
                    <td>{{order.sale_price}}</td>
                    <td>{{order.product.name}}</td>
                    <td>{{order.quantity}}</td>
                    <td>{{order.description}}</td>
                    <td>{{order.delivered_date}}</td>
                   
                    {% if order.delivered == True %}
                        <td align="center"><i class="fa fa-fw fa-check"></i></span></td>
                    {% else %}
                        <td align="center"><i class="fa fa-fw fa-minus"></i></span></td>
                    {% endif %}
                    {% if order.canceled == True %}
                        <td align="center"><i class="fa fa-fw fa-close"></i></span></td>
                    {% else %}
                        <td align="center"><i class="fa fa-fw fa-minus"></i></span></td>
                    {% endif %}
            </tr>    
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
</div>

{% if messages %}
    {% for m in messages %}
    <div id="message" style="visibility: hidden">
      <p>{{m}}</p>
    </div>
    {% endfor %}
{% endif %}
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script>

  
  $( document ).ready(function() {
    var message = $('#message p').text();
    if(message){
      toastr.options.timeOut = 10000;
      return toastr.success(message);
    }
    if(localStorage.getItem("Deleted"))
    {
      localStorage.clear();
      toastr.options.timeOut = 10000;
      return toastr.success('O item foi excluido');
    }
  });
  
  var url ="{% url 'order:order_delete' %}"
  function deleteItem(pk){
    $.ajax({
        url : url, // the endpoint
        type : "POST", // http method
        data : { 
                'pk' : pk ,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
               }, // data sent with the post request
        success : function(json) {
          localStorage.setItem("Deleted",'1')
          window.location.reload(); 
          
        },
        // handle a non-successful response
        error : function(xhr,errmsg,err) {
          alert('deu ruim');
        }
        
    });
  }


</script>

{% endblock %}